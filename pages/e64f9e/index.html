<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginx使用 | Jason Lee</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/zero/img/favicon.ico">
    <meta name="description" content="技术总结">
    <meta name="keywords" content="blog">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/zero/assets/css/0.styles.ccab8576.css" as="style"><link rel="preload" href="/zero/assets/js/app.c90e4b6c.js" as="script"><link rel="preload" href="/zero/assets/js/2.89d6a3ed.js" as="script"><link rel="preload" href="/zero/assets/js/29.502951e3.js" as="script"><link rel="prefetch" href="/zero/assets/js/10.7cc3e4b2.js"><link rel="prefetch" href="/zero/assets/js/11.6aba2890.js"><link rel="prefetch" href="/zero/assets/js/12.14f1401c.js"><link rel="prefetch" href="/zero/assets/js/13.0c95be2c.js"><link rel="prefetch" href="/zero/assets/js/14.5dfa2cc8.js"><link rel="prefetch" href="/zero/assets/js/15.e00803bf.js"><link rel="prefetch" href="/zero/assets/js/16.39baa3ca.js"><link rel="prefetch" href="/zero/assets/js/17.a1d71f58.js"><link rel="prefetch" href="/zero/assets/js/18.60c4d40d.js"><link rel="prefetch" href="/zero/assets/js/19.db6edb47.js"><link rel="prefetch" href="/zero/assets/js/20.d222c370.js"><link rel="prefetch" href="/zero/assets/js/21.def56c2c.js"><link rel="prefetch" href="/zero/assets/js/22.6604a6f9.js"><link rel="prefetch" href="/zero/assets/js/23.b4be4005.js"><link rel="prefetch" href="/zero/assets/js/24.3428c1ce.js"><link rel="prefetch" href="/zero/assets/js/25.c1262a19.js"><link rel="prefetch" href="/zero/assets/js/26.e2f528f4.js"><link rel="prefetch" href="/zero/assets/js/27.208ad13f.js"><link rel="prefetch" href="/zero/assets/js/28.d02026f8.js"><link rel="prefetch" href="/zero/assets/js/3.f5225f61.js"><link rel="prefetch" href="/zero/assets/js/30.90335638.js"><link rel="prefetch" href="/zero/assets/js/31.112ed23b.js"><link rel="prefetch" href="/zero/assets/js/32.3d7e9ed1.js"><link rel="prefetch" href="/zero/assets/js/33.3c7aea3a.js"><link rel="prefetch" href="/zero/assets/js/34.f7a53604.js"><link rel="prefetch" href="/zero/assets/js/35.1ce05305.js"><link rel="prefetch" href="/zero/assets/js/36.ad240d82.js"><link rel="prefetch" href="/zero/assets/js/37.36515385.js"><link rel="prefetch" href="/zero/assets/js/4.4dcd79c8.js"><link rel="prefetch" href="/zero/assets/js/5.688dec4a.js"><link rel="prefetch" href="/zero/assets/js/6.d9f7f723.js"><link rel="prefetch" href="/zero/assets/js/7.3c8cb736.js"><link rel="prefetch" href="/zero/assets/js/8.36fd660b.js"><link rel="prefetch" href="/zero/assets/js/9.5c8ec57d.js">
    <link rel="stylesheet" href="/zero/assets/css/0.styles.ccab8576.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zero/" class="home-link router-link-active"><!----> <span class="site-name">Jason Lee</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zero/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zero/pages/039d46/" class="nav-link">常用资源</a></li><li class="dropdown-subitem"><a href="/zero/pages/6d546b/" class="nav-link">html&amp;css</a></li><li class="dropdown-subitem"><a href="/zero/pages/fe0b24/" class="nav-link">webpack</a></li><li class="dropdown-subitem"><a href="/zero/pages/039d77/" class="nav-link">vue2.x</a></li><li class="dropdown-subitem"><a href="/zero/pages/039d48/" class="nav-link">vue3</a></li><li class="dropdown-subitem"><a href="/zero/pages/039d50/" class="nav-link">typescript入门</a></li><li class="dropdown-subitem"><a href="/zero/pages/039d49/" class="nav-link">工程化实践</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="interview" class="dropdown-title"><a href="/zero/pages/35a15c/" class="link-title">interview</a> <span class="title" style="display:none;">interview</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zero/pages/35a15c/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/1d1a2e/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/7d449f/" class="nav-link">es6常问</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/da0a0a/" class="nav-link">手写代码</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/ade6ea/" class="nav-link">错误监控</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/6423fa/" class="nav-link">webpack</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/d4dc7d/" class="nav-link">vue框架</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/269c3d/" class="nav-link">浏览器相关</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/5bae33/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/bb8af9/" class="nav-link">数据结构和算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="electron" class="dropdown-title"><a href="/zero/pages/54895f/" class="link-title">electron</a> <span class="title" style="display:none;">electron</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zero/pages/54895f/" class="nav-link">学习笔记</a></li></ul></div></div><div class="nav-item"><a href="/zero/pages/4ff0e8/" class="nav-link">工具</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/zero/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zero/pages/039d46/" class="nav-link">常用资源</a></li><li class="dropdown-subitem"><a href="/zero/pages/6d546b/" class="nav-link">html&amp;css</a></li><li class="dropdown-subitem"><a href="/zero/pages/fe0b24/" class="nav-link">webpack</a></li><li class="dropdown-subitem"><a href="/zero/pages/039d77/" class="nav-link">vue2.x</a></li><li class="dropdown-subitem"><a href="/zero/pages/039d48/" class="nav-link">vue3</a></li><li class="dropdown-subitem"><a href="/zero/pages/039d50/" class="nav-link">typescript入门</a></li><li class="dropdown-subitem"><a href="/zero/pages/039d49/" class="nav-link">工程化实践</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="interview" class="dropdown-title"><a href="/zero/pages/35a15c/" class="link-title">interview</a> <span class="title" style="display:none;">interview</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zero/pages/35a15c/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/1d1a2e/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/7d449f/" class="nav-link">es6常问</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/da0a0a/" class="nav-link">手写代码</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/ade6ea/" class="nav-link">错误监控</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/6423fa/" class="nav-link">webpack</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/d4dc7d/" class="nav-link">vue框架</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/269c3d/" class="nav-link">浏览器相关</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/5bae33/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/zero/pages/bb8af9/" class="nav-link">数据结构和算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="electron" class="dropdown-title"><a href="/zero/pages/54895f/" class="link-title">electron</a> <span class="title" style="display:none;">electron</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zero/pages/54895f/" class="nav-link">学习笔记</a></li></ul></div></div><div class="nav-item"><a href="/zero/pages/4ff0e8/" class="nav-link">工具</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/zero/pages/4ff0e8/" class="sidebar-link">git常用操作</a></li><li><a href="/zero/pages/b1625f/" class="sidebar-link">npm常用命令</a></li><li><a href="/zero/pages/7528c0/" class="sidebar-link">Mac使用</a></li><li><a href="/zero/pages/a0ba85/" class="sidebar-link">vim常用命令</a></li><li><a href="/zero/pages/e64f9e/" aria-current="page" class="active sidebar-link">nginx使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/zero/pages/e64f9e/#nginx-使用" class="sidebar-link">nginx 使用</a></li><li class="sidebar-sub-header level2"><a href="/zero/pages/e64f9e/#基本命令" class="sidebar-link">基本命令</a></li><li class="sidebar-sub-header level2"><a href="/zero/pages/e64f9e/#配置文件" class="sidebar-link">配置文件</a></li><li class="sidebar-sub-header level2"><a href="/zero/pages/e64f9e/#静态内容" class="sidebar-link">静态内容</a></li><li class="sidebar-sub-header level2"><a href="/zero/pages/e64f9e/#代理服务器" class="sidebar-link">代理服务器</a></li><li class="sidebar-sub-header level2"><a href="/zero/pages/e64f9e/#fastcgi-代理" class="sidebar-link">FastCGI 代理</a></li><li class="sidebar-sub-header level2"><a href="/zero/pages/e64f9e/#gzip-压缩" class="sidebar-link">gzip 压缩</a></li><li class="sidebar-sub-header level2"><a href="/zero/pages/e64f9e/#查看安装" class="sidebar-link">查看安装</a></li><li class="sidebar-sub-header level2"><a href="/zero/pages/e64f9e/#引用" class="sidebar-link">引用</a></li></ul></li><li><a href="/zero/pages/c8755d/" class="sidebar-link">vscode代码调试</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-7872fe94><div class="articleInfo" data-v-7872fe94><ul class="breadcrumbs" data-v-7872fe94><li data-v-7872fe94><a href="/zero/" title="首页" class="iconfont icon-home router-link-active" data-v-7872fe94></a></li> <li data-v-7872fe94><a href="/zero/categories/?category=%E5%B7%A5%E5%85%B7" title="分类" data-v-7872fe94>工具</a></li></ul> <div class="info" data-v-7872fe94><div title="作者" class="author iconfont icon-touxiang" data-v-7872fe94><a href="https://github.com/LRG00" target="_blank" title="作者" class="beLink" data-v-7872fe94>jason lee</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-7872fe94><a href="javascript:;" data-v-7872fe94>2021-09-07</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">nginx使用<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="nginx-使用"><a href="#nginx-使用" class="header-anchor">#</a> nginx 使用</h2> <p>Nginx 是一个免费的，开源的，高性能的 HTTP 服务器和反向代理，以及 IMAP / POP3 代理服务器。 Nginx 以其高性能，稳定性，丰富的功能，简单的配置和低资源消耗而闻名。很多高知名度的网站都使用 Nginx，如：Netflix，GitHub，SoundCloud，MaxCDN 等。</p> <p>Nginx 有一个主线程（ master process）和几个工作线程（worker process）。主线程的目的是<strong>加载</strong>和<strong>验证</strong>配置文件、<strong>维护</strong>工作线程。</p> <p>工作线程处理实际的请求，Nginx 采用<strong>基于事件</strong>的模型和<strong>依赖操作系统</strong>的机制在工作线程之间高效地分发请求。工作线程的数量可配置，也可自动调整为服务器 CPU 的数量。</p> <p>Nginx 及其模块的工作方式由配置文件确定。 默认情况下，配置文件名为 <code>nginx.conf</code>，放在 <code>/usr/local/nginx/conf</code> 、<code>/etc/nginx</code> 或者 <code>/usr/local/etc/nginx</code> 文件夹中。</p> <h2 id="基本命令"><a href="#基本命令" class="header-anchor">#</a> 基本命令</h2> <p>Nginx 启动之后，可以使用以下命令控制:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Copynginx -s <span class="token operator">&lt;</span>signal<span class="token operator">&gt;</span>
</code></pre></div><p>其中<code>-s</code>意思是向主进程发送信号，<code>signal</code>可以为以下四个中的一个:</p> <ol><li><code>stop</code> — 快速关闭</li> <li><code>quit</code> — 优雅关闭</li> <li><code>reload</code> — 重新加载配置文件</li> <li><code>reopen</code> — 重新打开日志文件</li></ol> <p>当运行<code>nginx -s quit</code>时，Nginx 会等待工作进程处理完成当前请求，然后将其关闭。当你修改配置文件后，并不会立即生效，而是等待重启或者收到<code>nginx -s reload</code>信号。</p> <p>当 Nginx 收到 <code>nginx -s reload</code> 信号后，首先检查配置文件的语法。语法正确后，主线程会开启新的工作线程并向旧的工作线程发送关闭信号，如果语法不正确，则主线程回滚变化并继续使用旧的配置。当工作进程收到主进程的关闭信号后，会在处理完当前请求之后退出。</p> <h2 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h2> <p>Nginx 配置的核心是定义要处理的 <code>URL</code> 以及如何响应这些 <code>URL</code> 请求，即定义一系列的**虚拟服务器（Virtual Servers）**控制对来自特定域名或者 IP 的请求的处理。</p> <p>每一个虚拟服务器定义一系列的 <code>location</code> 控制处理特定的 URI 集合。每一个<code>location</code>定义了对映射到自己的请求的处理场景，可以返回一个文件或者代理此请求。</p> <p>Nginx 由不同的模块组成，这些模块由配置文件中指定的指令控制。 指令分为<strong>简单指令</strong>和<strong>块指令</strong>。</p> <p>一个简单指令包含<strong>指令名称</strong>和<strong>指令参数</strong>，以空格分隔，以分号（<code>;</code>）结尾。 块指令与简单指令类似，但是由大括号（<code>{</code>和<code>}</code>）包围。 如果块指令大括号中包含其他指令，则称该指令为上下文（如： <code>events</code>, <code>http</code>, <code>server</code> 和 <code>location</code>）。</p> <p>配置文件中的放在上下文之外的指令默认放在<strong>主配置文件</strong>中（类似继承主配置文件）。 <code>events</code> 和 <code>http</code> 放置在主配置文件中，<code>server</code> 放置在<code>http</code>块指令中，<code>location</code>放置在<code>server</code>块指令中。</p> <p>配置文件的注释以 <code>#</code> 开始。</p> <h2 id="静态内容"><a href="#静态内容" class="header-anchor">#</a> 静态内容</h2> <p>Web 服务器一个重要的功能是服务静态文件（图像或静态 HTML 页面）。例如，Nginx 可以很方便的让服务器从<code>/data/www</code> 获取 html 文件，从<code>/data/images</code>获取图片来返回给客户端，这只需要在<code>http</code>块指令中的<code>server</code>块指令中设置两个<code>location</code>块指令。</p> <p>首先，创建 <code>/data/www</code> 目录，并放入 <code>index.html</code>，创建 <code>/data/images</code> 目录并在其中放置一些图片。</p> <p>接下来，打开配置文件。 创建一个 <code>server</code> 块：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Copyhttp</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通常，配置文件可以包括多个 <code>server</code> 块，它们以<strong>端口</strong>和<strong>服务器名称</strong>来区分。当 Nginx 决定某一个 <code>server</code> 处理请求后，它将请求头中的 <code>URI</code> 和 <code>server</code> 块中的 <code>location</code> 块进行对比。
加入 <code>location</code> 块指令到 <code>server</code> 中：</p> <p>将以下位置块添加到服务器块：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Copylocation</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /data/www</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的 <code>location</code> 块指定 <code>/</code> 前缀与请求中的 <code>URI</code> 对比。对于匹配的请求，<code>URI</code> 将被添加到 <code>root</code> 指令中指定的路径，即 <code>/data/www</code>，以此形成本地文件系统的路径，如访问<code>http://localhost/bog/welcome.html</code>，对应服务器文件路径为<code>/data/www/bog/welcome.html</code>。 如果 <code>URI</code> 匹配多个 <code>location</code> 块，Nginx 采用<strong>最长前缀匹配原则</strong>（类似计算机网络里面的 IP 匹配）， 上面的 <code>location</code> 块前缀长度为 1，因此只有当所有其他 <code>location</code> 块匹配时，才使用该块。</p> <p>接下来，添加第二个位置块：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Copylocation</span> /images/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /data</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>它将匹配以<code>/images/</code>（<code>/</code> 也匹配这样的请求，但具有较短的前缀）开始的请求。</p> <p><code>server</code> 块的最终配置如下：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Copyserver</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /data/www</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /images/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /data</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>到目前为止，这已经是一个可以正常运行的服务器，它监听端口 80，并且可以在本地计算机上访问 <code>http://localhost/</code>。 对于 <code>/images/</code> 开头的请求，服务器将从 <code>/data/images</code> 目录发送文件。 如，对于 <code>http://localhost/images/example.png</code> 请求，nginx 将响应 <code>/data/images/example.png</code>文件。 如果不存在，nginx 将返回 404。<code>URI</code> 不以 <code>/images/</code> 开头的请求将映射到 <code>/data/www</code> 目录。 例如，对于 <code>http://localhost/some/example.html</code> 请求，nginx 将响应 <code>/data/www/some/example.html</code> 文件。</p> <h2 id="代理服务器"><a href="#代理服务器" class="header-anchor">#</a> 代理服务器</h2> <p>Nginx 的一个常见应用是将其设置为代理服务器（Proxy Server），即接受客户端的请求并将其转发给代理服务器，再接受代理服务器发来的响应，将它们发送到客户端。</p> <p>比如我们可以用一个 Nginx 实例实现对图片文件的请求使用本地文件系统，而其他请求转发到代理服务器。</p> <p>首先，向 Nginx 的配置文件中添加一个 <code>server</code> 块来定义代理服务器：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Copyserver</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">8080</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">root</span> /data/up1</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此服务器侦听端口 8080，并将所有请求映射到本地文件系统上的 <code>/data/up1</code> 目录。 创建此目录并将 <code>index.html</code> 放入其中。 注意，<code>root</code> 指令放在 <code>server</code> 上下文中，这样 当 <code>location</code> 块中不含 <code>root</code> 指令时将使用所属 <code>server</code> 的 <code>root</code> 指令。</p> <p>接下来，使用上一节中的服务器配置，并将其修改为代理服务器配置。 在第一个位置块中，加上<code>proxy_pass</code>指令：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Copyserver</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
           <span class="token comment"># proxy_pass指令的参数为：协议+主机名+端口号</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://localhost:8080</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /images/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /data</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改第二个 匹配 <code>/images/</code> 前缀的 <code>location</code> 块，使其与请求图像文件的扩展名相匹配：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Copylocation</span> ~ \.(gif|jpg|png)$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /data/images</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该参数是一个正则表达式，匹配以.gif，.jpg 或.png 结尾的所有 URI。 正则表达式应该以 <code>~</code> 开头。 相应的请求将映射到 <code>/data/images</code> 目录。</p> <p>当 Nginx 选择一个 <code>location</code> 块来处理请求时，它首先检查指定 <code>location</code> 块的前缀，记住具有最长前缀的 <code>location</code> 块，然后检查正则表达式。 如果与正则表达式匹配， Nginx 选择此 <code>location</code> 块，否则，选择先前记住的 <code>location</code> 块。</p> <p>代理服务器的最终配置如下：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Copyserver</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://localhost:8080/</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> ~ \.(gif|jpg|png)$</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /data/images</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此服务器将过滤以.gif，.jpg 或.png 结尾的请求，并将它们映射到 <code>/data/images</code> 目录（通过向 <code>root</code> 指令的参数添加请求的 URI），并将所有其他请求发送给上面配置的代理服务器。</p> <p>这样，图片和其他请求就可以使用不同的服务器来处理。</p> <h2 id="fastcgi-代理"><a href="#fastcgi-代理" class="header-anchor">#</a> FastCGI 代理</h2> <p>Nginx 可用于将请求路由到 FastCGI 服务器。快速通用网关接口（Fast Common Gateway Interface／FastCGI）是一种让交互程序与 Web 服务器通信的协议。因此 Nginx 可以将请求路由到 FastCGI 运行的应用程序，如 PHP 程序。</p> <p>使用 FastCGI 服务器的最基本的 Nginx 配置包括使用 <code>fastcgi_pass</code> 指令而不是 <code>proxy_pass</code> 指令，以及使用 <code>fastcgi_param</code> 指令来设置传递给 FastCGI 服务器的参数。 假设 FastCGI 服务器可在 <code>localhost:9000</code> 上访问。 以上一节中的代理服务器配置为基础，使用<code>fastcgi_pass</code>指令替换<code>proxy_pass</code>指令，并将参数更改为 <code>localhost:9000</code> 。 在 PHP 中， <code>SCRIPT_FILENAME</code> 参数用于确定脚本名称，而 <code>QUERY_STRING</code> 参数用于传递请求参数。 生成的配置将是：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Copyserver</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">fastcgi_pass</span>  localhost:9000</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">fastcgi_param</span> QUERY_STRING    <span class="token variable">$query_string</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> ~ \.(gif|jpg|png)$</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /data/images</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这将设置一个服务器，将路由除静态图像以外的所有请求到运行在 <code>localhost:9000</code> 的 FastCGI 服务器。</p> <h2 id="gzip-压缩"><a href="#gzip-压缩" class="header-anchor">#</a> gzip 压缩</h2> <ul><li>gzip 配置的常用参数</li> <li>gzip on|off;  #是否开启 gzip</li> <li>gzip_buffers 32 4K| 16 8K #缓冲(压缩在内存中缓冲几块? 每块多大?)</li> <li>gzip_comp_level [1-9] #推荐 6 压缩级别(级别越高,压的越小,越浪费 CPU 计算资源)</li> <li>gzip_disable #正则匹配 UA 什么样的 Uri 不进行 gzip</li> <li>gzip_min_length 200 # 开始压缩的最小长度(再小就不要压缩了,意义不在)</li> <li>gzip_http_version 1.0|1.1 # 开始压缩的 http 协议版本(可以不设置,目前几乎全是 1.1 协议)</li> <li>gzip_proxied          # 设置请求者代理服务器,该如何缓存内容</li> <li>gzip_types text/plain application/xml # 对哪些类型的文件用压缩 如 txt,xml,html ,css</li> <li>gzip_vary on|off  # 是否传输 gzip 压缩标志</li></ul> <p>例如 以下是配置</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>  <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">32</span> <span class="token number">4K</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">100</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">gzip_types</span> application/javascript text/css text/xml</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">gzip_disable</span> <span class="token string">&quot;MSIE [1-6]\.&quot;</span></span><span class="token punctuation">;</span> <span class="token comment">#配置禁用gzip条件，支持正则。此处表示ie6及以下不启用gzip（因为ie低版本不支持）</span>
  <span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
</code></pre></div><h2 id="查看安装"><a href="#查看安装" class="header-anchor">#</a> 查看安装</h2> <p>查看软件安装路径
<code>whereis nginx</code></p> <p>查询运行文件所在路径
<code>which nginx</code></p> <p><code>nginx -t</code> 检查配置文件</p> <h2 id="引用"><a href="#引用" class="header-anchor">#</a> 引用</h2> <ul><li><a href="https://lufficc.com/blog/nginx-for-beginners" target="_blank" rel="noopener noreferrer">https://lufficc.com/blog/nginx-for-beginners<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/qianpangzi/p/10922420.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/qianpangzi/p/10922420.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/zero/pages/a0ba85/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">vim常用命令</div></a> <a href="/zero/pages/c8755d/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">vscode代码调试</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/zero/pages/a0ba85/" class="prev">vim常用命令</a></span> <span class="next"><a href="/zero/pages/c8755d/">vscode代码调试</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>jason lee | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/zero/assets/js/app.c90e4b6c.js" defer></script><script src="/zero/assets/js/2.89d6a3ed.js" defer></script><script src="/zero/assets/js/29.502951e3.js" defer></script>
  </body>
</html>
